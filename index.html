<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Bonavena">
    <title>Bonavena Finance Tracker</title>
    
    <!-- Script necessari caricati via CDN (Ordine Corretto) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@0.321.0/dist/umd/lucide.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.0/umd/Recharts.js"></script>

    <style>
        /* CSS per ottimizzazione iOS */
        body {
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            user-select: none;
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
        }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        #root {
            min-height: 100vh;
        }

        .lucide {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Gestione sicura di Recharts (attesa caricamento globale)
        const { 
            XAxis, YAxis, ResponsiveContainer, 
            Cell, BarChart, Bar 
        } = window.Recharts || {};
        
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);

            return (
                <i 
                    data-lucide={name} 
                    className={`${className}`}
                    style={{ width: size, height: size }}
                ></i>
            );
        };

        const App = () => {
            const [view, setView] = useState('monthly');

            // Dati dell'applicazione
            const financeData = {
                monthly: {
                    label: "Gennaio 2026",
                    income: 71596,
                    expenses: 15090,
                    savingRate: 0.789,
                    categories: [
                        { name: 'Affitto', value: 7500 },
                        { name: 'Spesa', value: 1986 },
                        { name: 'Trasporti', value: 1100 },
                        { name: 'Svago', value: 860 },
                        { name: 'Altro', value: 3674 }
                    ],
                    allocation: [
                        { name: 'Base', value: 10825, color: '#ef4444' },
                        { name: 'Extra', value: 4265, color: '#f59e0b' },
                        { name: 'Invest.', value: 23000, color: '#10b981' },
                        { name: 'Liquid.', value: 33506, color: '#3b82f6' },
                    ]
                },
                annual: {
                    label: "Anno 2026",
                    income: 95862,
                    expenses: 27319,
                    netWorth: 99884.92,
                    cashLeft: 45543,
                    emergencyTarget: 33142.5,
                    savingRate: 0.715
                }
            };

            const formatCurrency = (val) => {
                return new Intl.NumberFormat('da-DK', {
                    style: 'currency',
                    currency: 'DKK',
                    maximumFractionDigits: 0
                }).format(val).replace('DKK', 'kr.');
            };

            const active = view === 'monthly' ? financeData.monthly : financeData.annual;

            // Se Recharts non Ã¨ caricato, mostra un caricamento semplice
            if (!window.Recharts) {
                return <div className="flex items-center justify-center h-screen">Caricamento...</div>;
            }

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-32 overflow-y-auto">
                    <div className="h-12 bg-white/80 backdrop-blur-xl sticky top-0 z-[60] safe-top" />

                    <header className="sticky top-12 z-50 bg-white/80 backdrop-blur-xl border-b border-slate-100 px-6 py-4 flex justify-between items-center">
                        <div>
                            <h1 className="text-2xl font-black tracking-tight">Finance</h1>
                            <p className="text-[10px] font-bold text-indigo-500 uppercase tracking-widest leading-none mt-1">
                                {active.label}
                            </p>
                        </div>
                        <button className="p-3 rounded-full bg-slate-100 active:scale-90 transition-transform">
                            <Icon name="refresh-cw" size={20} className="text-slate-600" />
                        </button>
                    </header>

                    <main className="p-5 space-y-6 max-w-md mx-auto">
                        <section className="bg-indigo-600 p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden active:scale-[0.98] transition-transform">
                            <div className="relative z-10 text-white">
                                <p className="text-[10px] font-bold opacity-60 uppercase tracking-widest mb-1">Patrimonio Netto</p>
                                <h2 className="text-4xl font-black tracking-tighter">
                                    {formatCurrency(financeData.annual.netWorth)}
                                </h2>
                                <div className="mt-6 inline-flex items-center gap-2 bg-white/20 backdrop-blur-md px-4 py-2 rounded-2xl">
                                    <Icon name="trending-up" size={14} className="text-emerald-300" />
                                    <span className="text-xs font-bold">{(active.savingRate * 100).toFixed(0)}% Saving Rate</span>
                                </div>
                            </div>
                            <div className="absolute -right-12 -bottom-12 w-48 h-48 bg-white/10 rounded-full blur-3xl"></div>
                        </section>

                        <nav className="flex bg-slate-200/50 p-1 rounded-2xl">
                            {['monthly', 'annual'].map(m => (
                                <button 
                                    key={m} 
                                    onClick={() => setView(m)} 
                                    className={`flex-1 py-3 rounded-xl text-[10px] font-black tracking-widest transition-all ${view === m ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500'}`}
                                >
                                    {m.toUpperCase()}
                                </button>
                            ))}
                        </nav>

                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-white p-5 rounded-[2rem] border border-slate-100 shadow-sm">
                                <Icon name="briefcase" size={20} className="text-blue-500 mb-3" />
                                <p className="text-[10px] font-bold text-slate-400 uppercase">Entrate</p>
                                <p className="text-lg font-black">{formatCurrency(active.income)}</p>
                            </div>
                            <div className="bg-white p-5 rounded-[2rem] border border-slate-100 shadow-sm">
                                <Icon name="trending-down" size={20} className="text-rose-500 mb-3" />
                                <p className="text-[10px] font-bold text-slate-400 uppercase">Uscite</p>
                                <p className="text-lg font-black">{formatCurrency(active.expenses)}</p>
                            </div>
                        </div>

                        <section className="bg-white p-6 rounded-[2.2rem] border border-slate-100 shadow-sm">
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-2">
                                    <Icon name="target" size={18} className="text-emerald-500" />
                                    <span className="text-[11px] font-black uppercase">Fondo Emergenza</span>
                                </div>
                                <span className="text-[9px] font-black text-emerald-600 bg-emerald-50 px-2 py-1 rounded-lg">SICURO</span>
                            </div>
                            <div className="flex items-end justify-between">
                                <div>
                                    <p className="text-2xl font-black">{formatCurrency(financeData.annual.cashLeft)}</p>
                                    <p className="text-[10px] font-bold text-slate-400">Target: {formatCurrency(financeData.annual.emergencyTarget)}</p>
                                </div>
                                <p className="text-xl font-black text-emerald-600">137%</p>
                            </div>
                        </section>

                        {view === 'monthly' && (
                            <section className="bg-slate-900 p-7 rounded-[2.5rem] shadow-xl">
                                <h3 className="text-[10px] font-black text-slate-500 uppercase mb-6 flex items-center gap-2">
                                    <Icon name="pie-chart" size={14} className="text-indigo-400" /> Asset Allocation
                                </h3>
                                <div className="h-[180px] w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={financeData.monthly.allocation} layout="vertical" margin={{ left: -30 }}>
                                            <XAxis type="number" hide />
                                            <YAxis 
                                                dataKey="name" 
                                                type="category" 
                                                width={100} 
                                                tick={{ fontSize: 9, fill: '#64748b', fontWeight: 800 }} 
                                                axisLine={false} 
                                                tickLine={false} 
                                            />
                                            <Bar dataKey="value" radius={[0, 10, 10, 0]} barSize={12}>
                                                {financeData.monthly.allocation.map((entry, index) => (
                                                    <Cell key={`cell-${index}`} fill={entry.color} />
                                                ))}
                                            </Bar>
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                            </section>
                        )}
                    </main>

                    <footer className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-2xl border-t border-slate-100 px-10 pt-4 pb-10 flex justify-around items-center rounded-t-[2.5rem] z-[60] safe-bottom">
                        <button className="focus:outline-none"><Icon name="bar-chart-3" size={28} className="text-indigo-600" /></button>
                        <button className="focus:outline-none"><Icon name="calendar" size={28} className="text-slate-300" /></button>
                        <button className="focus:outline-none"><Icon name="credit-card" size={28} className="text-slate-300" /></button>
                        <button className="focus:outline-none"><Icon name="wallet" size={28} className="text-slate-300" /></button>
                    </footer>
                </div>
            );
        };

        // Inizializzazione sicura dopo il caricamento della pagina
        window.addEventListener('load', () => {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                const root = ReactDOM.createRoot(rootElement);
                root.render(<App />);
            }
        });
    </script>
</body>
</html>
